---
title: "Benchmarking binary predicates"
author: "Nils Ratnaweera"
date: "2019-05-19T11:00:00+01:00"
categories: ["R"]
tags: ["GIS", "sf","benchmarking","R"]
---



<pre class="r"><code>library(sf)
library(tidyverse)
library(microbenchmark)
monte_generoso &lt;- st_buffer(st_sfc(st_point(c(722758.81,87648.67)),crs = 21781),1000)

points &lt;- st_sample(st_buffer(monte_generoso,1000),1000,what = &quot;centers&quot;)

ggplot() + 
  geom_sf(data = points)+
  geom_sf(data = monte_generoso,fill = &quot;red&quot;,alpha = 0.5) + 
  theme_void()</code></pre>
<p><img src="/post/2019_05_19_benchmarking_binary_predicates_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>mbm  &lt;- microbenchmark(
  intersects = st_intersects(monte_generoso,points),
  within = st_within(points,monte_generoso),
  contains = st_contains(monte_generoso,points),
  times = 100
)</code></pre>
<pre class="r"><code>autoplot(mbm)</code></pre>
<pre><code>## Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
<p><img src="/post/2019_05_19_benchmarking_binary_predicates_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>ou &lt;- map_dfr(c(10,100,500,1000,5000,10000),function(x){
  
  points &lt;- st_sample(st_buffer(monte_generoso,1000),x,what = &quot;centers&quot;)

  mbm  &lt;- microbenchmark(
  intersects = st_intersects(monte_generoso,points),
  within = st_within(points,monte_generoso),
  contains = st_contains(monte_generoso,points),
  times = 10
  )
  as.data.frame(mbm) %&gt;%
    mutate(n = x)
})

ou %&gt;%
  mutate(time = time/1e9) %&gt;%
  group_by(expr,n) %&gt;%
  summarise(
    mean = mean(time),
    q25 = quantile(time,0.25),
    q75 = quantile(time,0.75)
  ) %&gt;%
ggplot(aes(n,mean, colour = expr)) +
  geom_line() +
  geom_pointrange(aes(ymin = q25,ymax = q75)) +
  labs(x = &quot;# data points&quot;,y = &quot;Duration (seconds)&quot;, colour = &quot;Binary Predicate Operation&quot;) +
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="/post/2019_05_19_benchmarking_binary_predicates_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
